{
    "app-id":"org.firestormviewer.FirestormViewer",
    "runtime":"org.freedesktop.Platform",
    "runtime-version":"23.08",
    "sdk":"org.freedesktop.Sdk",
    "command":"firestorm-viewer",
    "separate-locales":false,
    "finish-args":[
        "--share=ipc",
        "--socket=x11",
        "--socket=pulseaudio",
        "--share=network",
        "--allow=multiarch",
        "--device=dri",
        "--filesystem=~/.firestorm_x64:create",
        "--filesystem=xdg-desktop",
        "--filesystem=xdg-documents",
        "--filesystem=xdg-download",
        "--filesystem=xdg-music",
        "--filesystem=xdg-pictures",
        "--filesystem=xdg-run/app/com.discordapp.Discord:create",
        "--talk-name=org.freedesktop.Notifications",
        "--talk-name=org.freedesktop.secrets",
        "--own-name=com.secondlife.ViewerAppAPIService",
        "--env=LD_LIBRARY_PATH=/app/extra/lib/:/app/lib32/:/app/lib"
    ],
    "cleanup":[
        "/share/man",
        "/share/doc",
        "/share/gtk-doc"
    ],
    "writable-sdk": true,
    "build-options":{
        "strip":true
    },
    "add-extensions":{
        "org.freedesktop.Platform.Compat.i386":{
            "directory":"lib/i386-linux-gnu",
            "version":"23.08"
        }
    },
    "sdk-extensions":[
        "org.freedesktop.Sdk.Compat.i386",
        "org.freedesktop.Sdk.Extension.toolchain-i386"
    ],
    "modules":[
        "shared-modules/glu/glu-9.json",
        "shared-modules/gtk2/gtk2.json",
        "shared-modules/dbus-glib/dbus-glib.json",
        {
            "name":"libnotify",
            "buildsystem":"meson",
            "config-opts":[
                "-Ddocbook_docs=disabled",
                "-Dintrospection=disabled",
                "-Dtests=false",
                "-Dgtk_doc=false",
                "-Dman=false"
            ],
            "cleanup":[
                "/bin"
            ],
            "sources":[
                {
                    "type":"archive",
                    "url":"https://download.gnome.org/sources/libnotify/0.8/libnotify-0.8.3.tar.xz",
                    "sha256":"ee8f3ef946156ad3406fdf45feedbdcd932dbd211ab4f16f75eba4f36fb2f6c0"
                }
            ]
        },
        {
            "name":"libidn",
            "sources":[
                {
                    "type":"archive",
                    "url":"https://ftp.gnu.org/gnu/libidn/libidn-1.34.tar.gz",
                    "sha256":"3719e2975f2fb28605df3479c380af2cf4ab4e919e1506527e4c7670afff6e3c"
                }
            ],
            "build-options":{
                "arch":{
                    "x86_64":{
                        "prepend-pkg-config-path":"/app/lib32/pkgconfig:/usr/lib/i386-linux-gnu/pkgconfig",
                        "ldflags":"-L/app/lib32",
                        "append-path":"/usr/lib/sdk/toolchain-i386/bin",
                        "env":{
                            "CC":"i686-unknown-linux-gnu-gcc",
                            "CXX":"i686-unknown-linux-gnu-g++"
                        },
                        "libdir":"/app/lib32"
                    }
                }
            }
        },
        {
            "name":"libgnome-keyring",
            "config-opts":[
                "--disable-static",
                "--disable-gtk-doc",
                "--disable-coverage",
                "--disable-introspection"
            ],
            "sources":[
                {
                    "type":"archive",
                    "url":"https://download.gnome.org/sources/libgnome-keyring/3.12/libgnome-keyring-3.12.0.tar.xz",
                    "sha256":"c4c178fbb05f72acc484d22ddb0568f7532c409b0a13e06513ff54b91e947783"
                },
                {
                    "type":"shell",
                    "commands":[
                        "autoreconf -fi"
                    ]
                }
            ]
        },
        "pypi-dependencies.json",
        {
          "name": "glu",
          "buildsystem": "meson",
          "sources": [
            {
              "type": "archive",
              "url": "https://archive.mesa3d.org/glu/glu-9.0.3.tar.xz",
              "sha256": "bd43fe12f374b1192eb15fe20e45ff456b9bc26ab57f0eee919f96ca0f8a330f"
            }
          ]
        },
        {
            "name":"ubuntu-libcypto",
            "buildsystem":"simple",
            "sources":[
                {
                    "type":"file",
                    "url":"http://mirrors.edge.kernel.org/ubuntu/pool/main/libx/libxcrypt/libcrypt1_4.4.27-1_amd64.deb",
                    "sha256":"3fa566e9f861a08736cbc5a97562d9d6e4f0c00450fbeafcb6d7583423b04a98"
                }
            ],
            "build-commands":[
                  "ar x libcrypt1_4.4.27-1_amd64.deb",
                  "tar -xvf data.tar.zst",
                  "cp lib/x86_64-linux-gnu/* /app/lib/"
            ]
        },
        {
            "name":"firestorm",
            "build-options": {
		        "build-args": [ "--share=network" ]
	        },
            "buildsystem":"simple",
            "sources":[
                {
                    "type":"git",
                    "url":"https://github.com/FirestormViewer/fs-build-variables.git",
                    "commit": "c57be16efb2b48d9e117c7449fc105c7f9da16d0",
                    "dest": "fs-build-variables"
                },
                {
                    "type":"git",
                    "url":"https://github.com/FirestormViewer/phoenix-firestorm.git",
                    "commit":"f8664080696586a524193445f9452ac5c6d1f3fd",
                    "dest": "phoenix-firestorm"
                }
            ],
            "build-commands":[
		"rm /etc/resolv.conf",
		"echo 'nameserver 8.8.8.8' > /etc/resolv.conf",
                "cp -v /app/include/GL/glu.h /usr/include/GL/glu.h",
                "cp -v /app/lib/pkgconfig/glu.pc /usr/lib/x86_64-linux-gnu/pkgconfig/glu.pc",
        	"cp -v /app/lib/libGLU* /usr/lib/x86_64-linux-gnu/",
                "cd phoenix-firestorm && AUTOBUILD_VARIABLES_FILE=/run/build/firestorm/fs-build-variables/variables autobuild configure -A 64 -c ReleaseFS_open && AUTOBUILD_VARIABLES_FILE=/run/build/firestorm/fs-build-variables/variables autobuild build -A 64 -c ReleaseFS_open"
            ]
        }
    ]
}

